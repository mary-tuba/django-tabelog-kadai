{% extends 'admin_panel/base.html' %}

{% block title %}ダッシュボード - 管理者パネル{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active">ダッシュボード</li>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-tachometer-alt"></i> ダッシュボード</h1>
    <div class="text-muted">
        最終更新: {{ "now"|date:"Y年m月d日 H:i" }}
    </div>
</div>

<!-- 統計カード -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">総会員数</h5>
                        <h2 class="mb-0">{{ total_users }}</h2>
                    </div>
                    <div>
                        <i class="fas fa-users fa-2x opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">総店舗数</h5>
                        <h2 class="mb-0">{{ total_restaurants }}</h2>
                    </div>
                    <div>
                        <i class="fas fa-store fa-2x opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">総レビュー数</h5>
                        <h2 class="mb-0">{{ total_reviews }}</h2>
                    </div>
                    <div>
                        <i class="fas fa-star fa-2x opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">総予約数</h5>
                        <h2 class="mb-0">{{ total_reservations }}</h2>
                    </div>
                    <div>
                        <i class="fas fa-calendar-alt fa-2x opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- 最近の登録ユーザー -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-user-clock"></i> 最近の登録ユーザー
                </h5>
            </div>
            <div class="card-body">
                {% if recent_users %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>ユーザー名</th>
                                    <th>登録日</th>
                                    <th>ステータス</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in recent_users %}
                                <tr>
                                    <td>{{ user.username }}</td>
                                    <td>{{ user.date_joined|date:"m/d H:i" }}</td>
                                    <td>
                                        {% if user.is_staff %}
                                            <span class="badge bg-danger">管理者</span>
                                        {% elif user.is_premium %}
                                            <span class="badge bg-warning">プレミアム</span>
                                        {% else %}
                                            <span class="badge bg-secondary">一般</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">最近の登録ユーザーはありません。</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- 最近のレビュー -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-star"></i> 最近のレビュー
                </h5>
            </div>
            <div class="card-body">
                {% if recent_reviews %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>ユーザー</th>
                                    <th>店舗</th>
                                    <th>評価</th>
                                    <th>投稿日</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for review in recent_reviews %}
                                <tr>
                                    <td>{{ review.user.username }}</td>
                                    <td>{{ review.restaurant.name|truncatechars:20 }}</td>
                                    <td>
                                        <span class="text-warning">
                                            {% for i in "12345" %}
                                                {% if forloop.counter <= review.rating %}
                                                    <i class="fas fa-star"></i>
                                                {% else %}
                                                    <i class="far fa-star"></i>
                                                {% endif %}
                                            {% endfor %}
                                        </span>
                                    </td>
                                    <td>{{ review.created_at|date:"m/d H:i" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">最近のレビューはありません。</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- 管理者向けクイックアクション -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-bolt"></i> クイックアクション
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <a href="{% url 'admin_panel:admin_user_create' %}" class="btn btn-outline-primary d-block mb-2">
                            <i class="fas fa-user-shield"></i> 管理者追加
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{% url 'admin_panel:regular_user_create' %}" class="btn btn-outline-success d-block mb-2">
                            <i class="fas fa-user-plus"></i> ユーザー追加
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{% url 'admin_panel:user_list' %}" class="btn btn-outline-info d-block mb-2">
                            <i class="fas fa-users"></i> 会員管理
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{% url 'admin_panel:restaurant_list' %}" class="btn btn-outline-warning d-block mb-2">
                            <i class="fas fa-store"></i> 店舗管理
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <a href="{% url 'admin_panel:company_info_edit' %}" class="btn btn-outline-info d-block mb-2">
                            <i class="fas fa-building"></i> 会社情報編集
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{% url 'admin_panel:category_list' %}" class="btn btn-outline-secondary d-block mb-2">
                            <i class="fas fa-tags"></i> カテゴリ管理
                        </a>
                    </div>
                    <div class="col-md-3">
                        <!-- 将来の機能用 -->
                    </div>
                    <div class="col-md-3">
                        <!-- 将来の機能用 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}